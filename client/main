local QBCore = exports['qb-core']:GetCoreObject()
local noclipFlag = false

-- Noclip detection based on distance teleport
local lastCoords = nil
local lastCheckTime = 0

Citizen.CreateThread(function()
    while true do
        Citizen.Wait(1000)
        local ped = PlayerPedId()
        local coords = GetEntityCoords(ped)
        if lastCoords then
            local dist = #(coords - lastCoords)
            if dist > 50.0 then  -- suspicious teleport distance in 1 sec
                TriggerServerEvent('n9-anticheat:server:flag', 'noclip detected', dist)
            end
        end
        lastCoords = coords
    end
end)

-- Blacklisted vehicle detection
Citizen.CreateThread(function()
    while true do
        Citizen.Wait(5000)
        local ped = PlayerPedId()
        if IsPedInAnyVehicle(ped, false) then
            local veh = GetVehiclePedIsIn(ped, false)
            local model = GetEntityModel(veh)
            local vehName = GetDisplayNameFromVehicleModel(model)
            for _, blackVeh in pairs(Config.BlacklistedVehicles) do
                if vehName == blackVeh then
                    TriggerServerEvent('n9-anticheat:server:flag', 'blacklisted vehicle', vehName)
                end
            end
        end
    end
end)

-- Weapon blacklist check (on weapon equip)
Citizen.CreateThread(function()
    while true do
        Citizen.Wait(2000)
        local ped = PlayerPedId()
        local weapon = GetSelectedPedWeapon(ped)
        for _, blackWeapon in pairs(Config.BlacklistedWeapons) do
            if weapon == GetHashKey(blackWeapon) then
                TriggerServerEvent('n9-anticheat:server:flag', 'blacklisted weapon', blackWeapon)
            end
        end
    end
end)
